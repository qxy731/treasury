<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "sql-map-2.dtd">
<sqlMap namespace="upload">
	<!-- 
		UPLOAD_ID as uploadId,
		FILE_ID as fileId,
		FILE_NAME as fileName,
		FILE_SIZE as fileSize,
		FILE_PATH as filePath,
		DEL_FLAG as delFlag,
		DOWN_NUM as downNum,
		CREATE_USER as createUser,
		CREATE_TIME as createTime,
	-->
	<resultMap id="SysUploadFileMap" class="com.soule.app.table.SysUploadFilePo">
		<result property="uploadId" column="UPLOAD_ID"/>
		<result property="fileId" column="FILE_ID"/>
		<result property="fileName" column="FILE_NAME"/>
		<result property="fileType" column="FILE_TYPE"/>
		<result property="resultType" column="RESULT_TYPE"/>
		<result property="createOrg" column="CREATE_ORG"/>
		<result property="fileSize" column="FILE_SIZE"/>
		<result property="filePath" column="FILE_PATH"/>
		<result property="delFlag" column="DEL_FLAG"/>
		<result property="downNum" column="DOWN_NUM"/>
		<result property="createUser" column="CREATE_USER"/>
		<result property="createTime" column="CREATE_TIME"/>
	</resultMap>
	<select id="getSysUploadFileByKey" parameterClass="com.soule.app.table.SysUploadFilePo" 
		resultMap="SysUploadFileMap">
		select * from SYS_UPLOAD_FILE where 
			UPLOAD_ID = #uploadId#
			AND FILE_ID = #fileId#
	</select>

	<select id="getSysUploadFile" parameterClass="java.util.Map" resultMap="SysUploadFileMap">
		select * from SYS_UPLOAD_FILE 
		<dynamic prepend="where">
			<isNotEmpty prepend=" AND " property="uploadId">UPLOAD_ID = #uploadId#</isNotEmpty>
			<isNotEmpty prepend=" AND " property="fileId">FILE_ID = #fileId#</isNotEmpty>
			<isNotEmpty prepend=" AND " property="fileName">FILE_NAME = #fileName#</isNotEmpty>
			<isNotEmpty prepend=" AND " property="fileSize">FILE_SIZE = #fileSize#</isNotEmpty>
			<isNotEmpty prepend=" AND " property="filePath">FILE_PATH = #filePath#</isNotEmpty>
			<isNotEmpty prepend=" AND " property="delFlag">DEL_FLAG = #delFlag#</isNotEmpty>
			<isNotEmpty prepend=" AND " property="createUser">CREATE_USER = #createUser#</isNotEmpty>
			<isNotEmpty prepend=" AND " property="createTime">CREATE_TIME = #createTime#</isNotEmpty>
		</dynamic>
	</select>

	<update id="updSysUploadFile" parameterClass="com.soule.app.table.SysUploadFilePo">
		update SYS_UPLOAD_FILE 
		<dynamic prepend="set">
			<isNotNull prepend="," property="fileName">FILE_NAME = #fileName#</isNotNull>
			<isNotNull prepend="," property="fileSize">FILE_SIZE = #fileSize#</isNotNull>
			<isNotNull prepend="," property="filePath">FILE_PATH = #filePath#</isNotNull>
			<isNotNull prepend="," property="delFlag">DEL_FLAG = #delFlag#</isNotNull>
			<isNotNull prepend="," property="downNum">DOWN_NUM = #downNum#</isNotNull>
			<isNotNull prepend="," property="createUser">CREATE_USER = #createUser#</isNotNull>
			<isNotNull prepend="," property="createTime">CREATE_TIME = #createTime#</isNotNull>
			<isNotNull prepend="," property="fileType">FILE_TYPE = #fileType#</isNotNull>
			<isNotNull prepend="," property="resultType">RESULT_TYPE = #resultType#</isNotNull>
			<isNotNull prepend="," property="createOrg">CREATE_ORG = #createOrg#</isNotNull>
		</dynamic>
		where 
			UPLOAD_ID = #uploadId#
			AND FILE_ID = #fileId#
	</update>
	<update id="updateDownloadTime" parameterClass="com.soule.app.table.SysUploadFilePo">
		update SYS_UPLOAD_FILE set DOWN_NUM=DOWN_NUM+1 where UPLOAD_ID = #uploadId# AND FILE_ID = #fileId#
	</update>
	<insert id="saveSysUploadFile" parameterClass="com.soule.app.table.SysUploadFilePo">
		insert into SYS_UPLOAD_FILE (UPLOAD_ID,FILE_ID,FILE_NAME,FILE_SIZE,FILE_PATH,DEL_FLAG,DOWN_NUM,CREATE_USER,CREATE_TIME,FILE_TYPE,RESULT_TYPE,CREATE_ORG)
		values(#uploadId:VARCHAR# ,#fileId:VARCHAR# ,#fileName:VARCHAR# ,#fileSize:INTEGER# ,#filePath:VARCHAR# ,#delFlag:CHAR# ,0 ,#createUser:VARCHAR# ,#createTime:TIMESTAMP#,#fileType:VARCHAR# ,#resultType:CHAR# ,#createOrg:VARCHAR#  )
	</insert>

	<delete id="delSysUploadFile" parameterClass="com.soule.app.sys.filetransfer.FileTransferFilePo">
		update SYS_UPLOAD_FILE set DEL_FLAG='1' where UPLOAD_ID = #uploadId# AND FILE_ID = #fileId#
	</delete>
</sqlMap>
